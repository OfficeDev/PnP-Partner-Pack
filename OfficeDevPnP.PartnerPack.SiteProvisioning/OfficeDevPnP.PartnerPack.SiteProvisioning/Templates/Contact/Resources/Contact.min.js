$(document).ready(function(){"use strict";var e,t;e={items:[],FIRSTNAME_ID:"txtfirstName",LASTNAME_ID:"txtlastName",MOBILENUMBER_ID:"txtmobileNumber",CONTACT_LIST_NAME:"Contacts%20List",TOPN_RECORDS_DISPLAY:3e3,ContactSearch:function(){var e=window.location.protocol+"//"+window.location.host+_spPageContextInfo.siteServerRelativeUrl+"/";t.init($("#searchResults"),e),t.GetContactsFromSPList()},FilterContact:function(t,n,l){var r="";return null!==t&&t.length>0&&(l===e.FIRSTNAME_ID?r=t.filter(function(e){return e.FirstName===n}):l===e.LASTNAME_ID?r=t.filter(function(e){return e.Title===n}):l===e.MOBILENUMBER_ID&&(r=t.filter(function(e){return e.CellPhone===n}))),r},FilterContactByRegex:function(t,n,l){var r=new RegExp("^"+n,"ig"),a="";return null!==t&&t.length>0&&(l===e.FIRSTNAME_ID?a=t.filter(function(e){return e.FirstName.match(r)}):l===e.LASTNAME_ID?a=t.filter(function(e){return e.Title.match(r)}):l===e.MOBILENUMBER_ID&&(a=t.filter(function(e){return e.CellPhone.match(r)}))),a},ReturnAutoCompleteResponse:function(t,n,l){null!==n&&n.length>0?l===e.FIRSTNAME_ID?t($.map(n,function(e){return{label:e.FirstName,value:e.FirstName}})):l===e.LASTNAME_ID?t($.map(n,function(e){return{label:e.Title,value:e.Title}})):l===e.MOBILENUMBER_ID&&t($.map(n,function(e){return{label:e.CellPhone,value:e.CellPhone}})):t([{label:"No results found.",val:-1}])},RenderDiv:function(e){var t="<div class='result-row' style='padding-bottom:5px; border-bottom: 1px solid #c0c0c0;'>",n="<span class='bold-class'>Full Name:</span> <a href='#'>"+e.FirstName+" "+e.Title+"</a><br/><span class='bold-class'>Mobile:</span><span> "+e.CellPhone+"</span><br/><span class='bold-class'>Email:</span><span> "+e.EMail+"</span><br/>";return t+=n,t+="</div>"},GetValueById:function(e){return $("#"+e).val()},ClearTextbox:function(e){$("#"+e).val("")},RenderContacts:function(){var t="<div class='results'>";$.each(e.items,function(n){var l=e.items[n];t+=e.RenderDiv(l)}),t+="</div>",$("#searchResults").html(t)}},t={element:"",url:"",init:function(e,n){t.element=e,t.url=n},GetContactsFromSPList:function(){$.ajax({url:t.url+"/_api/lists/getbytitle('"+e.CONTACT_LIST_NAME+"')/items?$select=FirstName,Title,CellPhone,EMail&$top="+e.TOPN_RECORDS_DISPLAY+"&$orderby=FirstName asc",method:"GET",headers:{accept:"application/json;odata=verbose"},success:t.onSuccess,error:t.onError})},onSuccess:function(t){var n=t.d.results,l="<div class='results'>";if(0===n.length){var r="<div class='result-row' style='padding-bottom:5px; border-bottom: 1px solid #c0c0c0;'><span class='bold-class'>No Contacts Available</span><br/>";l+=r,l+="</div>"}else $.each(n,function(t){var r=n[t];l+=e.RenderDiv(r);var a={FirstName:r.FirstName,Title:r.Title,CellPhone:r.CellPhone,EMail:r.EMail};e.items.push(a)});l+="</div>",$("#searchResults").html(l)},onError:function(e){$("#searchResults").html("<h3>An error occured</h3><br/>"+JSON.stringify(e))}},e.ContactSearch();var n;$('input[type="text"]').on("change keyup",function(){var t=$(this).val();""===t&&e.RenderContacts()}),$('input[type="text"]').autocomplete({source:function(t,l){n=$(this.element).prop("id");var r=[];n===e.FIRSTNAME_ID?(e.ClearTextbox(e.LASTNAME_ID),e.ClearTextbox(e.MOBILENUMBER_ID),r=e.FilterContactByRegex(e.items,e.GetValueById(e.FIRSTNAME_ID),e.FIRSTNAME_ID),e.ReturnAutoCompleteResponse(l,r,e.FIRSTNAME_ID)):n===e.LASTNAME_ID?(e.ClearTextbox(e.FIRSTNAME_ID),e.ClearTextbox(e.MOBILENUMBER_ID),r=e.FilterContactByRegex(e.items,e.GetValueById(e.LASTNAME_ID),e.LASTNAME_ID),e.ReturnAutoCompleteResponse(l,r,e.LASTNAME_ID)):n===e.MOBILENUMBER_ID&&(e.ClearTextbox(e.FIRSTNAME_ID),e.ClearTextbox(e.LASTNAME_ID),r=e.FilterContactByRegex(e.items,e.GetValueById(e.MOBILENUMBER_ID),e.MOBILENUMBER_ID),e.ReturnAutoCompleteResponse(l,r,e.MOBILENUMBER_ID))},select:function(t,l){if(l.item){var r;if(n===e.FIRSTNAME_ID?r=e.FilterContact(e.items,l.item.value,e.FIRSTNAME_ID):n===e.LASTNAME_ID?r=e.FilterContact(e.items,l.item.value,e.LASTNAME_ID):n===e.MOBILENUMBER_ID&&(r=e.FilterContact(e.items,l.item.value,e.MOBILENUMBER_ID)),null!==r&&r.length>0){var a=r[0],s="<div class='results'>";s=s+e.RenderDiv(a)+"</div>",$("#searchResults").html(s)}}}})});